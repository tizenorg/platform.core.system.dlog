
This is a README for dlog, Android logging system adapted for TIZEN.

------------------------------------------------------------------

Function and purpose
--------------------

This is a logging subsystem collecting events from system and/or
applications. It is based on four circucular buffers implemented in
kernel and accessible by device nodes (number and sizes are hardcoded
in kernel):

/dev/log_system
/dev/log_radio
/dev/log_main
/dev/log_events

Kernel module implementing buffers and devices is in separate
repository. If 'log_system' or 'log_events' device does not exists or
is not writable its logs are redirected to 'log_main'. If 'log_main'
or 'log_radio' device does not exists or is not writable all logs are
discarded.

Dlog consists of three parts:
- user space library (libdlog) providing functions
  amd macros for writing logs
- user space daemon (dlogutil) and tool that:
  reads logs, stores in files, rotates, applies filters etc.
- user space tool (dlogctrl) that controls level and kind
  of collected logs

More information can be found:
https://wiki.tizen.org/wiki/IVI/Enable_Logging
http://elinux.org/Android_Logging_System

Optional build flags
--------------------

--with-systemd-journal : it forwards logs to journal instead /dev/log_*
device nodes. (using sd_journal_send function)

How to use
----------

libdlog
-------

Every component that can generate logs should be linked to
libdlog library and include dlog.h header.
There is defined set of macros that are used to write logs.
These macros are used for different buffers and priorities.

LOG[DIWE] - logs to 'log_main'
SLOG[DIWE] - logs to 'log_system'
RLOG[DIWE] - logs to 'log_radio'
ALOG[DIWE] - logs to 'log_events'

The last character determines priority of a message:

D - Debug
I - Info
W - Warning
E - Error

It is possible to add a tag. One can define a macro LOG_TAG before
including dlog.h. The value of the macro will be used as a message tag.

dlogutil
--------

Usage: dlogutil [options] [filterspecs]

options include:

  -s              Set default filter to silent.
                  Like specifying filterspec '*:s'

  -f <filename>   Log to file. Default to stdout

  -r [<kbytes>]   Rotate log every kbytes. (16 if unspecified). Requires -f

  -n <count>      Sets max number of rotated logs to <count>, default 4

  -v <format>     Sets the log print format, where <format> is one of:

                  Name of format   Fields in prefix of log line

                  brief (default)  <priority> <tag> <pid>
                  process          <priority> <pid>
                  tag              <priority> <tag>
                  thread           <priority> <pid> <tid>
                  raw              (nothing)
                  time             <time> <priority> <tag> <pid>
                  threadtime       <time> <pid> <tid> <priority> <tag>
                  long             <time> <pid> <tid> <priority> <tag>

  -c              clear (flush) the entire log and exit, conflicts with '-g'

  -d              dump the log and then exit (don't block)

  -t <count>      print only the most recent <count> lines (implies -d)

  -g              get the size of the log's ring buffer and exit, conflicts with '-c'

  -b <buffer>     request alternate ring buffer
                  ('main' (default), 'radio', 'system')");

filterspecs are a series of
  <tag>[:priority]

where <tag> is a log component tag (or * for all) and priority is:

  V    Verbose

  D    Debug

  I    Info

  W    Warn

  E    Error

  F    Fatal

  S    Silent (supress all output)

'*' means '*:D' and <tag> by itself means <tag>:V
If no filterspec is found, filter defaults to '*:I'

The one dlogutil process could write logs to one file,
if more files are needed more dlogutil processes should be run.

Examples:

dlogutil -r 1024 -n 3 -f /var/log/dlog -v time *:W

  Rotate log every 1024 kbytes.
  The max number of rotated logs are 3.
  Logs are written to /var/log/dlog
  The format of logs is 'time'.
  Logged are messages with all tags and priority Warn or above.

dlogutil -b radio -v time -f /var/log/seq.radio.log -r 1000 -n 10

  Read logs from /dev/log_radio.
  The format of logs is 'time'.
  Logs are written to /var/log/seq.radio.log
  Rotate log every 1000 kbytes.
  The max number of rotated logs are 10.
  Logged are messages with all tags and priority Info or above.

dlogctrl
--------

Usage: dlogctrl {get|set} platformlog [0|1]

Gets or sets platformlog option which determines
whether logs with lower id than LOG_ID_APPS are written.
(0 - no, 1 - yes)

dlogtests
---------

Usage: dlogtests

Perform embedded selftests.

